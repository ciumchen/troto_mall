!function(t,a,s){function o(t){this.list=t.list,this.load=t.load,this.nav=t.nav,this.on=t.on,this.noRecord=t.noRecord,this.page=1,this.type=1,this.scrTop=0,this.url=t.url,this.setHTML=t.setHTML,this.cacheArr=[],this.flag=!1,this.init()}o.prototype.selPacteBtnTab=function(){var t=this;this.nav.on("touchend",function(){return $(this).hasClass("on")?!1:(t.type=$(this).attr("data-type"),$(this).addClass(t.on).siblings().removeClass(t.on),t.noRecord.hide(),t.load.show().find("img").show(),t.load.find("span").hide(),void t.getData(t.type))})},o.prototype.getData=function(t){var a=this,t=t||1;this.page=1,this.list.html(""),a.cacheArr[t]?(a.scrollLoad(),a.showPageData(a.cacheArr[t])):this.getAjaxPage(t,this.page,function(s){a.scrollLoad(),a.showPageData(s),"string"!=typeof s&&""!=t&&(a.cacheArr[t]=s)})},o.prototype.showPageData=function(t){var a=this;if("string"!=typeof t){a.load.hide();var s="";if(0!=t.obj.length){for(var t=t.obj,o=0,e=t.length;e>o;o++){var i=t[o];s+=a.setHTML(i)}a.list.append(s)}}else a.load.find("img").hide(),a.load.find("span").text(t).show();a.flag=!1},o.prototype.scrollLoad=function(){var s=this;$(t).on("scroll",function(){s.hei=parseInt($(a).height()),s.scrTop=parseInt($(this).scrollTop()),s.conHei=parseInt($(this).height()),s.flag||s.hei-(s.scrTop+s.conHei)<40&&(s.load.show(),s.page++,s.flag=!0,s.getAjaxPage(s.type,s.page,function(t){s.showPageData(t)}))})},o.prototype.getAjaxPage=function(a,s,o){var e=this;$.ajax({type:"post",url:e.url,data:{type:a,page:s},dataType:"json",success:function(i){if(200==i.status)o&&o(i);else if(-200==i.status)$(t).unbind("scroll"),o&&o("没有卡券了"),1==s&&(e.load.hide(),e.noRecord.show());else{if(0!=i.status)return setTimeout(function(){e.getAjaxPage(a,s,o)},2e3),!1;e.load.hide()}}})},o.prototype.init=function(){this.load.show(),this.getData(),this.selPacteBtnTab()},t.TicketList=o}(window,document);